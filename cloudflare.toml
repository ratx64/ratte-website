[build]
command = "npm run build"
publish = "dist"

[build.environment]
NODE_VERSION = "18"

# Canonical URL redirects - ensure www redirects to non-www
[[redirects]]
from = "https://www.ratte.xyz/*"
to = "https://ratte.xyz/:splat"
status = 301
force = true

[[redirects]]
from = "http://www.ratte.xyz/*"
to = "https://ratte.xyz/:splat"
status = 301
force = true

[[redirects]]
from = "http://ratte.xyz/*"
to = "https://ratte.xyz/:splat"
status = 301
force = true

[[redirects]]
from = "http://ratte.seweraim.com/*"
to = "https://ratte.xyz/:splat"
status = 301
force = true

[headers]
# Security headers
[[headers.headers]]
key = "X-Frame-Options"
value = "SAMEORIGIN"

[[headers.headers]]
key = "X-Content-Type-Options"
value = "nosniff"

[[headers.headers]]
key = "Referrer-Policy"
value = "strict-origin-when-cross-origin"

# SEO headers
[[headers.headers]]
key = "Cache-Control"
value = "public, max-age=3600, s-maxage=86400"

[[headers.headers]]
key = "Link"
value = "</sitemap.xml>; rel=\"sitemap\"; type=\"application/xml\""

# Performance headers
[[headers.headers]]
key = "Strict-Transport-Security"
value = "max-age=31536000; includeSubDomains; preload"

[[headers.headers]]
key = "Permissions-Policy"
value = "interest-cohort=()"

# Content Security Policy
[[headers.headers]]
key = "Content-Security-Policy"
value = "default-src 'self'; script-src 'self' 'unsafe-inline' https://player.twitch.tv https://fonts.googleapis.com https://www.googletagmanager.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https:; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://player.twitch.tv https://www.google-analytics.com; frame-src https://player.twitch.tv; base-uri 'self'; form-action 'self'; upgrade-insecure-requests;" 